{% extends "outbreak_detection/base.html" %}

{% block content %}
<h2>Outbreak Clusters</h2>

<div class="filter-bar">
    <div class="filter-group">
        <label>Status:</label>
        <select onchange="window.location.href='{% url 'outbreak_detection:clusters_list' %}?status=' + this.value">
            <option value="active" {% if current_status == 'active' %}selected{% endif %}>Active</option>
            <option value="investigating" {% if current_status == 'investigating' %}selected{% endif %}>Investigating</option>
            <option value="resolved" {% if current_status == 'resolved' %}selected{% endif %}>Resolved</option>
        </select>
    </div>
</div>

<p><strong>{{ clusters|length }}</strong> cluster{{ clusters|length|pluralize }} ({{ current_status }})</p>

<table class="data-table">
    <tr>
        <th>Unit</th>
        <th>Infection Type</th>
        <th>Organism</th>
        <th style="text-align: center;">Cases</th>
        <th style="text-align: center;">Severity</th>
        <th>Status</th>
        <th>First Case</th>
        <th>Last Case</th>
        <th style="text-align: center;">Actions</th>
    </tr>
    {% for cluster in clusters %}
    <tr>
        <td><strong>{{ cluster.unit }}</strong></td>
        <td>{% include "_includes/badge.html" with text=cluster.infection_type|upper color="module" %}</td>
        <td>{{ cluster.organism|default:"-" }}</td>
        <td style="text-align: center;"><strong>{{ cluster.case_count }}</strong></td>
        <td style="text-align: center;">
            {% include "_includes/badge.html" with text=cluster.get_severity_display color=cluster.severity %}
        </td>
        <td>
            {% include "_includes/badge.html" with text=cluster.get_status_display color=cluster.status %}
        </td>
        <td>{{ cluster.first_case_date|date:"Y-m-d"|default:"-" }}</td>
        <td>{{ cluster.last_case_date|date:"Y-m-d"|default:"-" }}</td>
        <td style="text-align: center;">
            <a href="{% url 'outbreak_detection:cluster_detail' cluster.id %}" class="btn btn--primary" style="padding: 5px 10px; font-size: 12px;">View</a>
        </td>
    </tr>
    {% empty %}
    <tr>
        <td colspan="9" style="text-align: center; padding: 30px;">
            No clusters found with status "{{ current_status }}".
        </td>
    </tr>
    {% endfor %}
</table>

{% endblock %}
