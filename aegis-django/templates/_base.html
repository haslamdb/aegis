{% load static %}<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ module_display_name }}{% endblock %} - AEGIS</title>
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <link rel="stylesheet" href="{% static 'style-supplements.css' %}">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><path d=%22M50 5 L90 20 L90 45 C90 70 70 90 50 95 C30 90 10 70 10 45 L10 20 Z%22 fill=%22%230E7490%22/><path d=%22M50 15 L80 27 L80 45 C80 65 65 80 50 85 C35 80 20 65 20 45 L20 27 Z%22 fill=%22%230891B2%22/><path d=%22M45 55 L35 45 L40 40 L45 45 L60 30 L65 35 Z%22 fill=%22white%22/></svg>">
    {% block extra_css %}{% endblock %}
</head>
<body>
    {% block navbar %}
    {% include "_includes/navbar.html" %}
    {% endblock %}

    <main class="container">
        {% include "_includes/messages.html" %}
        {% block content %}{% endblock %}
    </main>

    <div class="disclaimer-banner">
        <strong>Demo Environment:</strong> All patient data displayed is simulated. No actual patient data is available through this dashboard.
    </div>

    {% include "_includes/footer.html" %}

    <script>
    function timeAgo(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const seconds = Math.floor((now - date) / 1000);
        const intervals = {
            year: 31536000, month: 2592000, week: 604800,
            day: 86400, hour: 3600, minute: 60
        };
        for (const [unit, secondsInUnit] of Object.entries(intervals)) {
            const interval = Math.floor(seconds / secondsInUnit);
            if (interval >= 1) {
                return interval === 1 ? `1 ${unit} ago` : `${interval} ${unit}s ago`;
            }
        }
        return 'just now';
    }

    function updateRelativeTimes() {
        document.querySelectorAll('[data-timestamp]').forEach(el => {
            const timestamp = el.getAttribute('data-timestamp');
            el.textContent = timeAgo(timestamp);
            const hours = (new Date() - new Date(timestamp)) / (1000 * 60 * 60);
            if (hours > 4 && !el.closest('.resolved')) {
                el.setAttribute('data-urgent', 'true');
            }
        });
    }

    let refreshInterval;
    const REFRESH_SECONDS = 30;

    function startAutoRefresh() {
        const indicator = document.getElementById('refresh-indicator');
        const countdown = document.getElementById('refresh-countdown');
        if (!indicator) return;
        let seconds = REFRESH_SECONDS;
        refreshInterval = setInterval(() => {
            seconds--;
            if (countdown) countdown.textContent = seconds;
            if (seconds <= 0) location.reload();
        }, 1000);
    }

    function stopAutoRefresh() {
        if (refreshInterval) clearInterval(refreshInterval);
    }

    document.addEventListener('DOMContentLoaded', () => {
        updateRelativeTimes();
        setInterval(updateRelativeTimes, 60000);
        if (document.getElementById('refresh-indicator')) startAutoRefresh();
    });

    document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
            stopAutoRefresh();
        } else if (document.getElementById('refresh-indicator')) {
            startAutoRefresh();
        }
    });
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>
