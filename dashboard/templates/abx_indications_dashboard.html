{% extends "base.html" %}

{% block title %}Antibiotic Indications - {{ app_name }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Antibiotic Indications</h1>
    <a href="{{ url_for('abx_indications.help_page') }}" class="btn btn-secondary">Help</a>
</div>

<div class="dashboard-summary">
    <div class="summary-card">
        <div class="summary-icon" style="color: var(--color-success);">&#x2705;</div>
        <div class="summary-content">
            <div class="summary-value">--</div>
            <div class="summary-label">Always Indicated</div>
        </div>
    </div>
    <div class="summary-card">
        <div class="summary-icon" style="color: var(--color-warning);">&#x26A0;</div>
        <div class="summary-content">
            <div class="summary-value">--</div>
            <div class="summary-label">Sometimes Indicated</div>
        </div>
    </div>
    <div class="summary-card">
        <div class="summary-icon" style="color: var(--color-danger);">&#x274C;</div>
        <div class="summary-content">
            <div class="summary-value">--</div>
            <div class="summary-label">Never Indicated</div>
        </div>
    </div>
    <div class="summary-card">
        <div class="summary-icon" style="color: var(--color-primary);">&#x1F3E5;</div>
        <div class="summary-content">
            <div class="summary-value">--</div>
            <div class="summary-label">Prophylaxis</div>
        </div>
    </div>
</div>

<div class="module-info">
    <h2>About This Module</h2>
    <p>The Antibiotic Indications module provides automated classification of antibiotic indication appropriateness
       using ICD-10 based assessment following the Chua et al. methodology with pediatric inpatient modifications.</p>

    <h3>Classification Categories</h3>
    <table class="help-table">
        <thead>
            <tr>
                <th>Category</th>
                <th>Code</th>
                <th>Meaning</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><span class="badge badge-success">Always</span></td>
                <td>A</td>
                <td>Antibiotic indicated - documented bacterial infection</td>
            </tr>
            <tr>
                <td><span class="badge badge-warning">Sometimes</span></td>
                <td>S</td>
                <td>May need antibiotics - clinical judgment required</td>
            </tr>
            <tr>
                <td><span class="badge badge-critical">Never</span></td>
                <td>N</td>
                <td>No antibiotic indication - likely inappropriate</td>
            </tr>
            <tr>
                <td><span class="badge badge-info">Prophylaxis</span></td>
                <td>P</td>
                <td>Surgical or medical prophylaxis indication</td>
            </tr>
            <tr>
                <td><span class="badge badge-success">Febrile Neutropenia</span></td>
                <td>FN</td>
                <td>Neutropenia + fever - empiric therapy indicated</td>
            </tr>
        </tbody>
    </table>

    <h3>Three-Layer Appropriateness Model</h3>
    <div class="layer-cards">
        <div class="layer-card layer-complete">
            <h4>Layer 1: Indication</h4>
            <p>Is there ANY indication for antibiotics?</p>
            <span class="layer-status">Implemented</span>
        </div>
        <div class="layer-card layer-planned">
            <h4>Layer 2: Agent</h4>
            <p>Is THIS antibiotic appropriate for the indication?</p>
            <span class="layer-status">Phase 2</span>
        </div>
        <div class="layer-card layer-planned">
            <h4>Layer 3: Duration</h4>
            <p>Is the DURATION appropriate?</p>
            <span class="layer-status">Phase 3</span>
        </div>
    </div>

    <h3>Special Logic</h3>
    <ul>
        <li><strong>Febrile Neutropenia:</strong> Automatically detected when neutropenia code (D70.x) + fever</li>
        <li><strong>Surgical Prophylaxis:</strong> Validated against 55+ CPT codes with agent/duration recommendations</li>
        <li><strong>Pediatric Modifications:</strong> Inpatient-specific overrides (e.g., bacteremia R78.81: N â†’ A)</li>
    </ul>
</div>

<div class="coming-soon-notice">
    <h3>Coming Soon</h3>
    <p>Real-time integration with Epic FHIR for automated antibiotic order assessment.</p>
</div>

<style>
.dashboard-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.summary-card {
    background: var(--color-white);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    box-shadow: var(--shadow-md);
    display: flex;
    align-items: center;
    gap: 1rem;
}

.summary-icon {
    font-size: 2rem;
}

.summary-value {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--color-gray-800);
}

.summary-label {
    font-size: 0.875rem;
    color: var(--color-gray-600);
}

.module-info {
    background: var(--color-white);
    border-radius: var(--radius-lg);
    padding: 2rem;
    box-shadow: var(--shadow-md);
    margin-bottom: 2rem;
}

.module-info h2 {
    margin-bottom: 1rem;
    color: var(--color-gray-800);
}

.module-info h3 {
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
    color: var(--color-gray-700);
}

.layer-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin: 1rem 0;
}

.layer-card {
    padding: 1rem;
    border-radius: var(--radius-md);
    border-left: 4px solid;
}

.layer-card h4 {
    margin: 0 0 0.5rem 0;
    font-size: 1rem;
}

.layer-card p {
    margin: 0 0 0.5rem 0;
    font-size: 0.875rem;
    color: var(--color-gray-600);
}

.layer-status {
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.25rem 0.5rem;
    border-radius: 9999px;
}

.layer-complete {
    background: var(--color-success-light);
    border-color: var(--color-success);
}

.layer-complete .layer-status {
    background: var(--color-success);
    color: white;
}

.layer-planned {
    background: var(--color-gray-100);
    border-color: var(--color-gray-400);
}

.layer-planned .layer-status {
    background: var(--color-gray-400);
    color: white;
}

.coming-soon-notice {
    background: var(--color-info-light);
    border: 1px dashed var(--color-primary);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    text-align: center;
}

.coming-soon-notice h3 {
    margin: 0 0 0.5rem 0;
    color: var(--color-primary);
}

.coming-soon-notice p {
    margin: 0;
    color: var(--color-gray-600);
}
</style>
{% endblock %}
